# 競品分析器模組 (Analyzers Module)

提供競品分析、LLM 報告生成和提示詞模板的完整解決方案，專為電商平台設計。

## 📁 目錄結構

```
shared/analyzers/
├── __init__.py              # 模組初始化和公開 API
├── competitor_analyzer.py   # 競品分析核心邏輯
├── llm_report_generator.py  # LLM 報告生成器
├── prompt_templates.py      # 提示詞模板管理
└── README.md               # 本檔案
```

### 基本使用流程

1. **創建分析器**：初始化 `CompetitorAnalyzer` 和 `LLMReportGenerator`
2. **收集產品資料**：使用 `collect_product_data()` 方法收集主產品和競品資料
3. **執行競品分析**：使用 `analyze_competitors()` 方法進行比較分析
4. **生成報告**：使用 `generate_report()` 方法生成 Markdown 格式的專業報告

## 📋 核心功能

### 1. 競品分析器 (`competitor_analyzer.py`)

**功能描述：**
競品分析器是整個模組的核心，負責收集產品資料並執行比較分析。它能夠從 Supabase 資料庫中獲取產品的基本資訊、最新快照資料和歷史快照資料，然後進行結構化的數值比較分析。

**主要特點：**
- **資料收集**：自動收集主產品和競品的基本資訊、價格、評分、評論數、BSR 排名等關鍵指標
- **基本比較**：執行價格、評分、評論數的統計比較（最大值、最小值、平均值）
- **資料驗證**：確保資料的完整性和正確性，處理缺失資料的情況
- **結構化輸出**：提供標準化的分析結果格式，便於後續處理

**分析流程：**
1. 根據提供的 ASIN 列表收集產品基本資訊
2. 獲取各產品的最新快照資料（價格、評分、評論數、BSR 等）
3. 提取並組織產品數據為標準格式
4. 執行主產品與競品之間的數值比較
5. 生成包含比較結果的結構化分析報告

**輸入參數：**
- `main_asin`: 主產品的 ASIN 識別碼
- `competitor_asins`: 競品 ASIN 列表
- `window_size`: 分析時間窗口（天數）

**輸出結果：**
包含主產品資料、競品資料和基本比較結果的完整分析報告，涵蓋價格比較、評分比較、評論數比較等關鍵指標。

### 2. LLM 報告生成器 (`llm_report_generator.py`)

**功能描述：**
LLM 報告生成器負責將競品分析的數據轉換為專業的 Markdown 格式報告。它使用 OpenAI GPT 模型來生成結構化、易讀的分析報告，包含執行摘要、產品分析、比較分析、市場洞察和策略建議等章節。

**主要特點：**
- **智能報告生成**：使用 GPT 模型將原始數據轉換為專業的商業分析報告
- **成本控制**：提供成本估算功能，幫助用戶控制 API 調用費用
- **錯誤處理**：完整的異常處理機制，確保報告生成的穩定性
- **格式標準化**：自動生成符合 Markdown 標準的結構化報告

**生成流程：**
1. 接收競品分析結果和參數
2. 準備和格式化分析資料供 LLM 使用
3. 構建專業的提示詞模板
4. 調用 OpenAI API 生成報告內容
5. 驗證和格式化報告，確保 Markdown 格式正確
6. 添加報告元資料（生成時間、模型版本等）

**配置選項：**
- 支援自定義 OpenAI API 金鑰
- 可選擇不同的 GPT 模型（預設為 gpt-3.5-turbo）
- 提供成本估算功能
- 可調整最大 token 數和創造性參數

### 3. 提示詞模板 (`prompt_templates.py`)

**功能描述：**
提示詞模板模組負責管理各種 LLM 提示詞模板，確保報告生成的一致性和專業性。它提供結構化的提示詞模板，幫助 LLM 生成符合特定格式和內容要求的分析報告。

**主要特點：**
- **模板化管理**：提供多種分析場景的標準化提示詞模板
- **格式一致性**：確保生成的報告具有統一的結構和格式
- **靈活配置**：支援根據不同需求調整提示詞內容
- **專業化設計**：針對電商競品分析場景優化的提示詞

**模板類型：**
- **競品分析模板**：專門用於生成競品比較分析報告
- **市場分析模板**：用於生成市場概況和競爭格局分析
- **自定義模板**：支援根據特定需求創建客製化模板

**核心功能：**
- 自動格式化產品資訊、比較指標和分析參數
- 生成結構化的報告大綱和內容要求
- 提供專業的商業分析術語和格式標準
- 支援多語言和本地化需求

## 🔧 技術特點

### 1. 簡化設計原則
- **移除複雜分析**：不包含缺乏學術基礎的趨勢分析功能
- **專注數據收集**：重點在於準確收集和整理原始數據
- **基本數值比較**：只進行簡單的統計比較（最大值、最小值、平均值）

### 2. 錯誤處理
- **完整的異常捕獲**：所有函數都包含完整的錯誤處理機制
- **優雅的降級**：當數據不足時提供適當的預設值
- **詳細的日誌記錄**：提供清晰的執行狀態信息

### 3. 資料驗證
- **類型檢查**：確保數據類型的正確性
- **空值處理**：妥善處理缺失的數據
- **BSR 資料處理**：正確處理 Amazon BSR 的列表格式
